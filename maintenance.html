<html lang="en" ng-app="myApp">
  <head>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/0.9.4/angular-material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700,400italic">
    <meta name="viewport" content="initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Maintenance</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
      <style>
.inputdemoBasicUsage .md-datepicker-button {
  width: 36px; }
    .gridListdemoDynamicTiles md-icon {
  width: 50%;
  height: 30%; }
.gridListdemoBasicUsage md-grid-list {
  margin: 8px; }
.gridListdemoBasicUsage .gray {
  background: #f5f5f5; }
.gridListdemoBasicUsage .green {
  background: #b9f6ca; }
.gridListdemoBasicUsage .yellow {
  background: #ffff8d; }
.gridListdemoBasicUsage .blue {
  background: #84ffff; }
.gridListdemoBasicUsage .purple {
  background: #b388ff; }
.gridListdemoBasicUsage .red {
  background: #ff8a80; }
.gridListdemoBasicUsage md-grid-tile {
  transition: all 400ms ease-out 50ms; 
} 
.green {
    background-color: green;
    color: white;
}
.red {
    background-color: red;
    color: white;
}
      </style>
  </head>
  <body  >
    <div ng-app="myApp" ng-controller="customersCtrl" ng-init="getDetails();getMonthlyDetails(mymonth,myyear);getCredentials();init()">
              <nav class="navbar navbar-inverse">
            <div class="container-fluid" >
                <div class="navbar-header ">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <a class="navbar-brand" href="">K.V.Phase-II</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav navbar-left">
                        <li class="inactive"><a href="homepage">Home</a></li>
                        <li class="inactive"><a href="/dashboard">Dashboard</a></li>
                        <li class="inactive"><a href="/receipts">Receipts</a></li>
                        <!--<li class="inactive"><a href="/email">Emails</a></li> -->
                        <li class="active"><a href="">Maintenance</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>     <a class="md-icon-button md-accent" aria-label="Favorite" data-toggle="modal" data-target="#credentialModal" data-whatever="@mdo">
                                            <span class="glyphicon glyphicon-log-in"></span> Login
                                            <md-tooltip> Change credentails</md-tooltip>
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </nav>
    <!-- Angular Material Dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/0.9.4/angular-material.min.js"></script>

                              <div class="form-group">
              
                              <div class="row">
                                    <div class="col-sm-11 col-md-11">                  
                                        <div ng-init="">
                                            <label>Year</label>
                                                <select  ng-model="selectedyear" ng-click="selectedmonth!=NULL && getMonthlyDetails(selectedmonth,selectedyear)" value="selectedyear">
                                            <option ng-repeat = "c in choice" >{{c}}</option>
                                            
                                            </select>
    
                                            <label>Month</label>
                                                <select  ng-model="selectedmonth"  ng-click="selectedmonth!=NULL && getMonthlyDetails(selectedmonth,selectedyear)" value="selectedmonth">
                                                        
                                                <option ng-repeat="option in months"  ng-d>{{option.name}}</option>
            
                                                </select>    
    
                                        </div>
                                    </div>
                                    <div class="col-sm-1 col-md-1"> 
                                            <md-button class="md-warn md-raised md-fab md-mini" aria-label="Eat cake" data-toggle="modal" data-target="#mailModal" data-whatever="@mdo">
                                            <span class="glyphicon glyphicon-send"></span>
                                            <md-tooltip> Send Remainder Mails</md-tooltip>

                                            </md-button>
                                    </div>
                                </div>
                            </div>
                    <div style="margin:50px" ng-show="visible">
                            <md-grid-list
                            md-cols-sm="1" md-cols-md="1" md-cols-gt-md="30"
                            md-row-height-gt-md="1:1" md-row-height="4:3"
                            md-gutter="4px" md-gutter-gt-sm="2px" >
                                
                                <md-grid-tile ng-repeat="x in flatnos" 
                                    md-colspan-sm="1" 
                                    ng-class="x.status"  >
                                    <span ng-if="x.status=='green'">
                                        
                                        <p ng-click="editGridDetails(x.FLAT_NO,selectedyear,selectedmonth)" data-toggle="modal" data-target="#gridModal" data-whatever="@mdo">
                                            
                                            {{x.FLAT_NO}} 
                                        </p>
                                    </span>
                                    <span ng-if="x.status=='red'">
                                        {{x.FLAT_NO}} 
                                    </span>
                                     
</md-grid-tile>
                        </md-grid-list>
                    </div>
          <div class="modal fade" id="gridModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">OWNER DETAILS</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="e.flatNo" class="control-label">Flat No:</label>

              
            <input type="text" class="form-control" ng-model="e.flatNo">
          </div>
           <div class="form-group">
            <label for="e.receiptId" class="control-label">Receipt ID :</label>
            <input type="text" class="form-control" ng-model="e.receiptId">
          </div>
          <div class="form-group">
            <label for="e.amount" class="control-label">Amount:</label>
            <input type="text" class="form-control" ng-model="e.amount">
          </div>
          <div class="form-group">
            <label for="e.received" class="control-label">Received : </label>
            <input type="text" class="form-control" ng-model="e.received">
          </div>


          <div class="form-group">
              <div flex="100" flex-gt-sm="25" layout="row" >
      <fieldset class="standard" flex>
        <label>Months</label>
        <div layout="row" layout-wrap flex>
          <div flex="25" ng-repeat="item in e.months">
            <md-checkbox  ng-click="toggle(item)" value="{{item}}" ng-checked="checked(item)">
            {{item}} 
            </md-checkbox>
          </div>
        </div>
      </fieldset>
    </div>

          </div>
          <div class="form-group">
            <label for="e.year" class="control-label">Year :</label>
            <input type="text" class="form-control" ng-model="e.year">
          </div>            
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="getMonthlyDetails(selectedmonth,selectedyear);">Cancel</button>
        <button type="button" class="btn btn-danger"  ng-click="deleteReciept()">Del Reciept</button>  

        <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="saveGridDetails();">Submit</button>
      </div>
    </div>
  </div>
</div>
        
          <div class="modal fade" id="mailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="exampleModalLabel">EMAIL TEMPLATE</h4>
                        </div>
                        <div ng-show="visibleSender">
                        <div class="modal-body" >
                            <form>
                                <div class="form-group">
                                    <label for="u.USER_NAME" class="control-label">User Name: {{u.username}}</label>
                                </div>                                
                                
                                                <label for="comment"> Body : </label>
                                
                                    <div class="pull-right btn-group btn-group-xs">
                                                <button type="button" class="btn btn-info" ng-click="toggleSelection()">
                                                    <span class="glyphicon glyphicon-pencil"></span>
                                    </button>
                                    </div>
                                <h3>
                <div ng-show="showemailtext">
  
  <textarea class="form-control" rows="10" columns="10" placeholder="body of the email" ng-model="emailcontent" value="emailcontent"></textarea>
  
                    </div>
                                </h3>
                        <div ng-hide="showemailtext">
                            <h3><pre>{{emailcontent}}</pre></h3>
            <hr>
            <md-checkbox  ng-click="toggleDefaulters()" ng-checked="toggleDefaulter" >
            Selective Email for Defaulters 
            </md-checkbox>
            <br>
                            <div ng-if="showdefaulterTextbox">
                                <!--
                                <div class="form-group">              
                                        <div class="row">
                                            <div class="col-sm-1 col-md-1">
                                            </div>
                                            <div class="col-sm-10 col-md-10">                  
                                                <div layout layout-sm="column">
                                                        <md-input-container flex>
                                                            <label>Add Defaulter Flatno: </label>
                                                                <input name="Add defaulter Flatno: " ng-model="defaulterflat" required ng-pattern="/^[B-Db-d]{1}-[0-9]{2}$/" md-maxlength="4" >
                                                       </md-input-container>
                                                        <md-button class="md-raised md-primary" ng-click="addDefaulter(defaulterflat);defaulterflat = null;" ng-disabled="defaulterflat==''"><span class="glyphicon glyphicon-plus"></span></md-button>

                                                        <div ng-if="countDefaulter>0">
                                                        <md-input-container flex>
                                                          <label>Del Defaulter Flatno: </label>
                                                          <input name="Del defaulter Flatno: " ng-model="deldefaulterflat" required ng-pattern="/^[B-Db-d]{1}-[0-9]{2}$/" md-maxlength="4" >
                                                        </md-input-container>
                                                       <md-button class="md-raised md-primary" ng-click="delDefaulter(deldefaulterflat);deldefaulterflat = null;" ng-disabled="deldefaulterflat==''">Del</md-button>

                                                        </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-1 col-md-1">                  
                                            </div>
                                        </div>
                                </div>
                                
                                -->
                                <md-input-container flex>
                                    <label>Add defaulter Flatno: </label>
                                  <input name="Add defaulter Flatno: " ng-model="defaulterflat" 
                 required ng-pattern="/^[B-Db-d]{1}-[0-9]{2}$/" md-maxlength="4" >
                                </md-input-container>
                            <md-button class="md-raised md-primary" ng-click="addDefaulter(defaulterflat);defaulterflat = null;" ng-disabled="defaulterflat==''">Add</md-button>
                                <span ng-if="defaulter.length>0">
                                <h4>Defaulters:<hr>
                                    <div ng-repeat="d in defaulter">
                                        {{d}}
                                <div class="pull-right btn-group btn-group-xs" ng-click="delDefaulter(d)">
                                        <span class="glyphicon glyphicon-remove"></span>     
                                    </div>
                                        
                                        <br>
                                </div>
                                <p id="showdefaulters"></p></h4>
                                </span>
                            </div>
                            </div>
                            </form>
                        
                            </div>
                        <div class="modal-footer">
                            <div ng-show="showemailtext">
                            <button type="button" class="btn btn-primary" ng-click="toggleSelection();putMailcontent();">Save </button>    
                                </div>
                            <div ng-hide="showemailtext">
                            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="revokeAuth()">Cancel</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="sendmails()">Send Mails</button>
                            
                            </div>
                        </div>
                    </div>
                        <div ng-hide="visibleSender">
                        <div class="modal-body" >
                                                    
          <div class="form-group">
            <label for="enteredpassword" class="control-label">Password :</label>
            <input type="password" class="form-control" ng-model="enteredpassword" 
                   data-ng-keypress="onFolderNumberKeyPress($event,enteredpassword)" >
          </div>                                
                                </div>

                            
                        <div class="modal-footer">
                                 
                            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="cleartext()">Cancel</button>
                            <button type="button" class="btn btn-primary"  ng-click="passwordvalidation(enteredpassword)">Submit</button> 
                
                            </div>

                            </div>
                        </div>
                        </div>
                    </div>
        
        
            <div class="modal fade" id="credentialModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">Credentials</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="u.USER_NAME" class="control-label">User Name:</label>
            <input type="text" class="form-control" ng-model="u.USER_NAME">
          </div>
          <div class="form-group">
            <label for="u.PASSWORD" class="control-label">Password :</label>
            <input type="password" class="form-control" ng-model="u.PASSWORD">
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="getCredentials()">Cancel</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="updateCredentials(u.USER_NAME,u.PASSWORD)">Save Credentials</button>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <script>
      var app = angular.module('myApp', ['ngMaterial']);
    app.controller('customersCtrl', function ($scope, $http, $compile,DataService) 
    {
            
            $scope.searched = false;
            $scope.date = new Date();
            var previousMonth = new Date($scope.date);
            var previousYear = new Date($scope.date);
            $scope.dateEditorEnabled = false;
            $scope.u;
            $scope.emailcontent="";
    
            var start = 2010;
            $scope.end = new Date().getFullYear();
			$scope.currentYear = new Date().getFullYear();
            var e=$scope.end;
            $scope.myyear=$scope.end;
            $scope.selectedyear=$scope.currentYear;
            //console.log($scope.selectedyear);
            var options = "";
            $scope.choice=[];
            for(var year=$scope.end ; year >=start;year--)
            {
                $scope.choice.push(year);
            
            }
            //console.log($scope.choice);
            $scope.m=new Date().getMonth()+1;
            //document.getElementById("year").innerHTML = options;            
            $scope.months=[
                    {id: '1', name: 'January'},
                    {id: '2', name: 'February'},
                    {id: '3', name: 'March'},
                    {id: '4', name: 'April'},
                    {id: '5', name: 'May'},
                    {id: '6', name: 'June'},
                    {id: '7', name: 'July'},
                    {id: '8', name: 'August'},
                    {id: '9', name: 'September'},
                    {id: '10', name: 'October'},                    
                    {id: '11', name: 'November'},
                    {id: '12', name: 'December'}
            ];        
            $scope.selectedmonth =$scope.months[$scope.m-1].name;
            $scope.selection = [];

            $scope.mymonth=$scope.months[$scope.m-1].name;
            $scope.getcolor = function(x)
            {
                if(x.status == 1)
                    return 'green';
                else 
                    return 'red';
            }

            $scope.onFolderNumberKeyPress = function(event,pass)
            {
                if (event.charCode == 13) //if enter then hit the search button
                {
                    $scope.passwordvalidation(pass);
                }
            }
            $scope.showemailtext = false;
            $scope.putMailcontent = function()
            {
                var request = {
                    body : $scope.emailcontent
                };
                $http.put('/putTemplate',request);
            }
            $scope.toggle=function(i)
            {
                //console.log(i);
                var idx = $scope.selection.indexOf(i);
                // is currently selected
                if (idx > -1) {
                  $scope.selection.splice(idx, 1);
                }

                // is newly selected
                else {
                  $scope.selection.push(i);
                }
                //console.log($scope.selection);                            
            }
            $scope.toggleSelection = function()
            {
            
                $scope.showemailtext = !$scope.showemailtext;
            }
            $scope.updateCredentials = function(USER_NAME,PASSWORD)
            {
                var request= {
                    pass : $scope.u.PASSWORD,
                    username : $scope.u.USER_NAME
                };
                $http.put('/auth',request);
                $http.get("/uid")
                    .success(function (response) { $scope.u=response; });
            }
            $scope.formarray = function(month,selectedyear)
            {
                for(var i=0;  i< $scope.flatnos.length ; i++)
                {
                    $scope.flatnos[i].status='red';
                    for(j=0;j< $scope.grid.length;j++)
                    {
                        $scope.grid[j].flatNo = angular.uppercase($scope.grid[j].flatNo);
                        if($scope.flatnos[i].FLAT_NO === $scope.grid[j].flatNo && $scope.grid[j].complete!="1")
                        {
                            $scope.grid[j].complete = 1;
                            $scope.flatnos[i].status='green';
                            break;
                        }
                    }
                }
                $scope.visible=true;
                //console.log("ADI");
            }
            $scope.z="0";
            $scope.sendDate = function(month,selectedyear)
            {
                if($scope.z!="0")
                {
                    $scope.formarray(month,selectedyear);
                }
            }
  
            $scope.mails = function(flatno)
            {
                return $http.get("/sendMail/"+flatno).success(function (response) { $scope.j=$scope.docs;});
            }  
            
            $scope.revokeAuth = function()
            {
                $scope.enteredpassword=null;
                $scope.authentication=0;
                $scope.visibleSender=false;
            }
            
            $scope.cleartext = function(){
                $scope.enteredpassword=null;
            }
            
            $scope.sendmails = function()
            {
                    $scope.maillist=[];
                    for(var i=0; i<$scope.flatnos.length ; i++)
                    {
                        var flag=0;                        
                        if($scope.toggleDefaulter)
                        {
                            
                            for(var j=0; j<$scope.defaulter.length;j++)                            
                            if(angular.uppercase($scope.flatnos[i].FLAT_NO) == $scope.defaulter[j])
                            {
                                flag=1;
                                break;
                            }
                        }
                        if(flag==0 && $scope.flatnos[i].status === "red")
                        {
                                $scope.maillist.push($scope.flatnos[i].FLAT_NO);
                        }
                    }
                  //  console.log($scope.maillist);
                    $scope.mails($scope.maillist);
                    $scope.authentication=0;
                    $scope.visibleSender=false;
                
            }

            $scope.getCredentials = function()
            {
                $http.get("/uid")
                    .success(function (response) { $scope.u=response; });                
            }
            $scope.init = function()
            {
                $scope.authentication = 0;
                $scope.defaulterflat="";
                $scope.deldefaulterflat="";
                
            }
            $scope.passwordvalidation = function(pass)
            {
                /*var request= {
                    pass : pass
                };*/
                //console.log("hie");
                //console.log(pass);
                DataService.getPasswordValidate(pass).then(
                    $scope.getPasswordDataSuccessHandler
                    );
                $scope.enteredpassword=null;
                DataService.getMailContent($scope.emailcontent).then(
                    $scope.getMailContentSuccessHandler
                    );
            }   
            $scope.checked =function(i)     
            {
                for(var j=0;j<$scope.selection.length;j++)
                    if($scope.selection[j]==i)
                        return true;
                return false;
            }
            $scope.toggleDefaulter=true;
            $scope.showdefaulterTextbox=true;
            $scope.toggleDefaulters = function()
            {                
                $scope.toggleDefaulter=!$scope.toggleDefaulter;
                $scope.showdefaulterTextbox=!$scope.showdefaulterTextbox;                
                return $scope.toggleDefaulter;
            }
            $scope.defaulter=[];
            $scope.addDefaulter = function(flatno)
            {
                var flag=0;
                if(flatno!=null)
                {
                    flatno=angular.uppercase(flatno);
                    $scope.flatnum=flatno;
                    for(var i=0;i<$scope.defaulter.length;i++)
                        if(flatno==$scope.defaulter[i])
                            flag=1;
                    if(!flag)
                    {
                        $scope.defaulter.push(flatno);
                     /*   
                        $scope.str="";
                        var disstr="";
                        for (var i=0;i<$scope.defaulter.length;i++)
                        {
                            disstr+='<div>'+$scope.defaulter[i]+' <div class="pull-right btn-group btn-group-xs"><p ng-click="delDefaulter('+$scope.defaulter[i]+')"><span class="glyphicon glyphicon-remove"></span></p></div></div><br>';
                        }
                            console.log(disstr);                        
                        var $el = $(disstr).appendTo("#showdefaulters");
                        $compile($el)($scope);
                       */     //document.getElementById('showdefaulters').innerHTML=disstr;
                        
                    }
                    //console.log($scope.defaulter);
                }
            }
            $scope.delDefaulter = function(flatno)
            {
                    //console.log(flatno);
                    if(flatno!=null)
                    {
                        var flag=0;
                        flatno=angular.uppercase(flatno);
                        var index=$scope.defaulter.indexOf(flatno);
                        if(index>-1)
                        {
                            $scope.defaulter.splice(index,1);
                            
                        }
                       // console.log($scope.defaulter);
                    }
            }

            $scope.getDetails = function() {
                DataService.getAllFlatsData().then(
                    $scope.getAllFlatsDataSuccessHandler
                );
            }
            $scope.deleteReciept = function()
            {
                var data = {
                    flatNo:$scope.e.flatNo,
                    receiptId:$scope.e.receiptId ,
                    amount:$scope.e.amount ,
                    date:$scope.date ,
                    paymentMode:$scope.e.paymentMode,
                    paymentTyp:$scope.e.paymentTyp,
                    remarks:$scope.e.remarks ,
                    received:$scope.e.received ,
                    year:$scope.e.year ,
                    months:$scope.selection
                };
                $http.post("URL FOR DELETE").success(function(response) {
                    $scope.getMonthlyDetails($scope.selectedmonth,$scope.selectedyear);
                    console.log("deleted");});
            }
            $scope.saveGridDetails=function()
            {
                    var data = {
                    flatNo:$scope.e.flatNo,
                    receiptId:$scope.e.receiptId ,
                    amount:$scope.e.amount ,
                    date:$scope.date ,
                    paymentMode:$scope.e.paymentMode,
                    paymentTyp:$scope.e.paymentTyp,
                    remarks:$scope.e.remarks ,
                    received:$scope.e.received ,
                    year:$scope.e.year ,
                    months:$scope.selection
                    };
                $http.put('updateReceipt/'+ $scope.e._id,data).success(function (response) { $scope.getMonthlyDetails($scope.selectedmonth,$scope.selectedyear); });
                

            }
            $scope.editGridDetails= function(flatno,month,year)
            {
                DataService.getEditGridDetails(flatno,month,year).then(
                    $scope.getEditGridDetailsSuccessHandler
                    );
            }
            $scope.getEditGridDetailsSuccessHandler = function(response)
            {
                $scope.e=response.data;
                $scope.selection=[];
                if($scope.e.months!=null)
                {
                    for (var i=0;i<$scope.e.months.length;i++)
                    {
                        $scope.selection.push($scope.e.months[i]);
                    }
                }
            
            }
            $scope.getPasswordDataSuccessHandler = function(response)
            {
                //console.log(response.data);
                $scope.authentication=response.data;
                //console.log($scope.authentication);
                if($scope.authentication == 0)
                    $scope.visibleSender = false;
                else if($scope.authentication == 1)
                    $scope.visibleSender = true;
            }
            $scope.getMailContentSuccessHandler = function(response)
            {
                $scope.emailcontent = response.data;
              //  console.log($scope.emailcontent);
            }
            $scope.getMonthlyDetails= function (month,year)
            {
                $scope.visible=false;
                $scope.mymonth=month;
                $scope.myyear = year;
                DataService.getAllMonthsData(month,year).then(
                    $scope.getAllMonthsDataSuccessHandler
                );        
            }
            
            
            $scope.getAllMonthsDataSuccessHandler = function(response)
            {
                $scope.grid=response.data.flats;    
                $scope.z++;
                $scope.sendDate($scope.mymonth,$scope.myyear);
            }
            $scope.getAllFlatsDataSuccessHandler = function(response)
            {
                $scope.flatnos=response.data.flats;
            
            }
            
            $scope.getOwnerDetails = function()
            {
                for(var i=0;i< $scope.owners.length; i++)
                {
                    $scope.getOwnedFlats(i); 
                }    
            }
            
            $scope.getOwnedFlats = function(particularOwner)
            {
                i = particularOwner;
                $scope.ownerId = $scope.owners[particularOwner].OWNER_ID; 
                for(var i =0; i< $scope.flat.length; i++)
                {
                    if($scope.flat[i].OWNERS == $scope.ownerId)
                    {
                        $scope.owners[particularOwner].ownedFlats=$scope.flat[i].FLAT_NO;
                    }
                }
            }
                                        
        });

        app.factory("DataService",function($http,$location){
            var _getDataService = 
            {
                getAllFlatsData :function()
                {
                    return $http.get('/getFlats');
                },
                getAllMonthsData :function(month,selectedyear)
                {
                    return $http.get('/sendstatus/'+month+'/'+selectedyear);
                },
                getPasswordValidate : function(pass)
                {
                    var request = {
                    pass : pass
                };
                    return $http.put('passauth/', request);
                },
                getMailContent :function(message)
                {
                    return $http.get('/getTemplate');
                },
                getEditGridDetails : function(flatno,year,month)
                {
                    return $http.get('/editReceipt/'+flatno+'/'+month+'/'+year);
                },
           
            }
            
            return _getDataService;
        });
    </script>
</body>
</html>