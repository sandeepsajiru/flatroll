<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Detail Page</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css" />
    <script type="text/javascript" src="jquery.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>


    <script type="text/javascript">
        $(document).ready(function () {

            $(".accordion h3:first").addClass("active");
            $(".accordion p:not(:first)").hide();

            $(".accordion h3").click(function () {
                $(this).next("p").slideToggle("slow")
                .siblings("p:visible").slideUp("slow");
                $(this).toggleClass("active");
                $(this).siblings("h3").removeClass("active");
            });

        });
    </script>


    <style type="text/css">
        body {
            margin: 10px auto;
            width: 100%;
            font: 75%/120% Arial, Helvetica, sans-serif;
        }

        .accordion {
            width: 100%;
            float: right;
            border-bottom: solid 1px #c4c4c4;
        }

            .accordion h3 {
                background: #e9e7e7 url(images/arrow-square.gif) no-repeat right -51px;
                padding: 7px 15px;
                margin: 0;
                font: bold 120%/100% Arial, Helvetica, sans-serif;
                border: solid 1px #c4c4c4;
                border-bottom: none;
                cursor: pointer;
            }

                .accordion h3:hover {
                    background-color: #e3e2e2;
                }

                .accordion h3.active {
                    background-position: right 5px;
                }

            .accordion p {
                background: #f7f7f7;
                margin: 0;
                padding: 10px 15px 20px;
                border-left: solid 1px #c4c4c4;
                border-right: solid 1px #c4c4c4;
            }

        body, td, th {
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div ng-app="myApp" ng-controller="customersCtrl">
        <nav class="navbar navbar-inverse">
            <div class="container-fluid">
                <div class="navbar-header ">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <a class="navbar-brand" href="https://www.google.co.in/#q=kendriya+vihar+hyderabad+indira+nagar">K.V.Phase-II</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav navbar-left">
                        <li class="inactive"><a href="">Home</a></li>
                        <li class="active" ng-click="searched = false;flatNumberEntered='' "><a href="/dashboard">Dashboard</a></li>
                        <li class="active"><a href="/receipts">Receipts</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
                <input type="text" class="form-control" ng-model="flatNumberEntered" placeholder="Search" size="150" maxlength="200" width="50 cm" />
            </div>
            <button type="submit" class="btn btn-default" ng-click="getFlatDetails(flatNumberEntered)">Submit</button>
        </form>
        <div class="container" ng-hide="searched" ng-init="getDetails()">              <h2>Flat Details</h2>

            <table class="table table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th>Flat Number</th>
                        <th>Name</th>
                        <th>Phone Number</th>
                        <th>Dues</th>
                    </tr>
                </thead>
                <tbody ng-repeat="x in owners" >
                    <tr>
                        <td>{{x.ownedFlats}}</td> 
                        <td>{{x.FIRST_NAME}} {{x.LAST_NAME}}</td>
                        <td>{{x.PHONE_NUMBERS}}</td>
                            
                        <td  style="background-color:red" width="1px" ng-show="x.dues==1"></td>
            
                        <td  style="background-color:green" width="1px" ng-show="x.dues==0"></td>

                    </tr>

                </tbody>

            </table>
        </div>

        <div class="container-fluid" ng-show="searched">
            <form class="form-inline" role="form">

                <div class="accordion">

                    <h3>OWNER DETAILS</h3>
                    <p>
                        Name of Owner : {{ownername}}
                        <br /><br />
                        E-Mail Id : {{owner.email}}
                        <br /><br />
                        Phone / Mobile : {{ownerphone}}
                        <br /><br />
                        Permanent Address Of Owner : {{owneraddress}}
                        <br /><br />
                        Current Address of Owner : {{owneraddress}}
                        <br /><br />
                    </p>
                    <h3>TENANT DETAILS</h3>
                    <p>
                        Name : {{tenant.name}}
                        <br /><br />
                        Phone / Mobile : {{tenant.mobile}}
                        <br /><br />
                        E-Mail Id : {{tenant.email}}
                        <br /><br />
                    </p>
                    <h3>MONTHLY STATUS</h3>
                    <p>JAN      FEB MAR APR MAY JUN JUL  AUG SEP OCT NOV DEC</p>

                    <h3>FLAT DETAILS    </h3>
                    <p>
                        Registration Number : {{registrationnumber}}
                        <br /><br />


                    </p>


                </div>
            </form>
        </div>



    </div>

    <script>
        var app = angular.module('myApp', []);
        app.controller('customersCtrl', function ($scope, $http, DataService) {

            $scope.searched = false;

            $scope.ownerid = "";
            $scope.ownername = "";
            $scope.ownerphone = "";
            $scope.owneraddress = "";
            $scope.flatNumberEntered;
            $scope.enteredValue = "";

            $scope.registrationnumber = "";
            
            $scope.color =[ 'red' , 'green' ];
            
            $scope.getFlatDetails = function (inputsearch) 
            {
                
                if(inputsearch === "")
                {
                    $scope.registrationnumber="";
                    $scope.ownerid="";
                    $scope.ownername="";
                    $scope.ownerphone="";
                    $scope.owneraddress="";
                }
                else
                {
                    $scope.searched = true;
                    console.log(inputsearch);
                    for (var i = 0; i < $scope.flat.length; i++) 
                    {
                        if ($scope.flat[i].FLAT_NO === inputsearch) 
                        {
                            console.log($scope.flat[i].FLAT_NO);
                            $scope.registrationnumber = $scope.flat[i].REGISTRATION_NUMBER;
                            $scope.ownerid = $scope.flat[i].OWNERS;

                            for (var j = 0; j < $scope.owners.length; j++) 
                            {
                                if($scope.ownerid === $scope.owners[j].OWNER_ID)
                                {
                                    $scope.ownername = $scope.owners[j].FIRST_NAME +" "+ $scope.owners[j].LAST_NAME;
                                    $scope.ownerphone = $scope.owners[j].PHONE_NUMBERS;
                                    $scope.owneraddress = $scope.owners[j].CITY;                                
                                }

                            }
                        }
                    }

                }
            }
         
            $scope.getDetails = function() {

                DataService.getOwnersData().then(
                    $scope.getOwnersDataSuccessHandler
                );
                

            }

            
            $scope.getOwnersDataSuccessHandler = function(response)
            {
                console.log(response);
                $scope.owners = response.data.docs;
                console.log($scope.owners);
                $scope.getOwnerDetails();
                $scope.getRandomSpan();
            }
            
            $scope.getOwnerDetails = function()
            {
            //     console.log($scope.owners);
                for(var i=0;i< $scope.owners.length; i++)
                {
                    $scope.getOwnedFlats(i); 
                }    
            }
            
            $scope.getOwnedFlats = function(particularOwner)
            {
                i = particularOwner;

                $scope.ownerId = $scope.owners[particularOwner].OWNER_ID; 
                $scope.owners[particularOwner].ownedFlats = []; 
                
                for(var i =0; i< $scope.flat.length; i++)
                {
                    if($scope.flat[i].OWNERS == $scope.ownerId)
                    {
                        $scope.owners[particularOwner].ownedFlats.push($scope.flat[i].FLAT_NO);
                    }
                }
                
            }
            
            $scope.getRandomSpan =function()
            {
                for(var i=0;i<$scope.owners.length;i++)
                {
                    $scope.owners[i].dues=Math.floor(Math.random()*2);
                }
            };


                            
            $http.get("/flatDetails")
            .success(function (response) { $scope.flat = response.docs; });


            $http.get("/tenantDetails")
            .success(function (response) { $scope.tenants = response.docs; });

            

        });


        app.factory("DataService",function($http,$location){
        
            var _getDataService = 
            {
                
                getOwnersData : function()
                {
            	   return $http.get('/ownerDetails');
                },
                getFlatsData : function()
                {
                    return $http.get('/flatDetails');
                },
                getTenantsData : function()
                {
                    return $http.get('/tenantDetails');
                }                
            
            }
            
            return _getDataService;
        });

    </script>

</body>
</html>
